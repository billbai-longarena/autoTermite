# Termite Daemon Project

An intelligent driver for orchestrating a software engineering swarm, primarily driving `codex` and `claude` (Anthropic's Claude Code) agents according to the **Termite Protocol**.

## ğŸ¯ Original Requirements

The goal is to create a "smart" daemon (`termite_daemon.py`) that replaces the simpler `codex_daemon.py`. This new daemon is powered by a cloud-based LLM (Claude Sonnet 4.6 via Azure) to make intelligent decisions based on the context of each agent's terminal.

### Core Objectives
1.  **Dual-Agent Orchestration**: Drive both `codex` and `claude code` simultaneously.
2.  **Role Specialization**:
    *   **Claude Code**: Functions as the **Auditor, Architect, and Reviewer**. It performs audits, explores requirements, designs features, and reviews completed tasks. **Strictly prohibited from writing code implementation.**
    *   **Codex**: Functions as the **Builder**. It executes the construction and coding tasks.
3.  **Intelligent Context Handling**: When an agent is idle (detected via CPU usage), the daemon captures its terminal output and asks the AI driver for the best next command.
4.  **Protocol Adherence**: Both agents must follow `TERMITE_PROTOCOL.md`. The daemon injects protocol-aware commands (e.g., "According to Termite Protocol, audit feature X").

### Workload Balancing & Pacing
To prevent the Architect (`claude`) from overwhelming the Builder (`codex`) or creating a backlog of unreviewed work:
*   **Lead Limit**: `claude` should only be 5-6 tasks ahead of `codex`.
*   **Mandatory Review**: Every completed task must be reviewed.
*   **Pause Mechanism**: If `claude` moves too fast or generates too many unreviewed designs, it must pause.
    *   The daemon detects a `[PAUSE]` signal from the AI.
    *   If triggered, `claude` is put to sleep (ignored) for **10 minutes** to allow `codex` to catch up.

### Technical Constraints
*   **Context Reading**: Must reliably read terminal output from macOS `Terminal.app`, handling different tab/window states (using `history` fallback).
*   **Process Detection**: Dynamically finds the correct TTY for `codex` and `claude` processes.
*   **Safety**: Cooldowns to prevent command spamming.

## ğŸ›  Usage

1.  **Configuration**:
    *   Ensure `.env` contains valid API keys (`AZURE_ANTHROPIC_API_KEY`).
    *   Ensure `TERMITE_PROTOCOL.md` is in the root directory.
    *   Optional runtime config file: `termite_process_config.json` (created by GUI).

2.  **Run GUI (optional but recommended)**:
    ```bash
    python3 termite_control_gui.py
    ```
    *   The GUI can dynamically detect `codex` / `claude` processes and configure each process independently:
        *   `enable_agent_team`
        *   `automate_process`
        *   `new_chat_on_done`
    *   The GUI also scans orphan `codex` / `claude` processes and lets you close selected ones.

3.  **Run Daemon**:
    ```bash
    sudo python3 termite_daemon.py
    ```
    *   *Note: `sudo` is required to inject keystrokes into TTYs.*
    *   Daemon will load `termite_process_config.json` every loop and apply per-process settings.

4.  **Logs**:
    *   AI decisions and context are logged to `termite_ai.log`.

## å¯åŠ¨æ–¹å¼

æ¨èä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼š

1. å¯åŠ¨ GUIï¼ˆè¿›ç¨‹è¯†åˆ« + æ¯è¿›ç¨‹é…ç½® + å­¤å„¿è¿›ç¨‹æ¸…ç†ï¼‰ï¼š
   ```bash
   cd /Users/bill.bai/Desktop/autoTermite
   python3 termite_control_gui.py
   ```

2. å¯åŠ¨ daemonï¼ˆè¯»å– GUI ä¿å­˜çš„é…ç½®å¹¶æ‰§è¡Œè‡ªåŠ¨åŒ–ï¼‰ï¼š
   ```bash
   cd /Users/bill.bai/Desktop/autoTermite
   sudo python3 termite_daemon.py
   ```

æˆ–è€…ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰ï¼š
```bash
cd /Users/bill.bai/Desktop/autoTermite
./start_termite.sh
```

è¯´æ˜ï¼š
- `termite_control_gui.py` ä¸éœ€è¦ `sudo`ã€‚
- `termite_daemon.py` éœ€è¦ `sudo`ï¼Œå› ä¸ºè¦å‘ç›®æ ‡ TTY æ³¨å…¥è¾“å…¥ã€‚
- GUI ä¸­ä¿å­˜çš„é…ç½®å†™å…¥ `termite_process_config.json`ï¼Œdaemon ä¼šåœ¨è½®è¯¢æ—¶è‡ªåŠ¨åŠ è½½ã€‚
- `start_termite.sh` ä¼šå…ˆåå°å¯åŠ¨ daemonï¼Œå†å‰å°æ‰“å¼€ GUIã€‚
- daemon æ ‡å‡†è¾“å‡ºä¼šå†™å…¥ `termite_daemon.stdout.log`ã€‚

## ğŸ“‚ File Structure

*   `termite_daemon.py`: Main daemon script.
*   `termite_control_gui.py`: GUI for per-process runtime settings and orphan-process cleanup.
*   `termite_process_utils.py`: Shared process scan/config helper.
*   `start_termite.sh`: One-click launcher for daemon + GUI.
*   `termite_process_config.json`: Per-process runtime config generated by GUI.
*   `TERMITE_PROTOCOL.md`: The governing protocol for agent behavior.
*   `.env`: Configuration secrets (API keys).
*   `codex_daemon.py`: (Legacy) Original simple daemon.
